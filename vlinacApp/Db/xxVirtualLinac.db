# Version 2.0
record(bi,"$(user):autoC") {
        field(ASG,"$(user)")
        field(PINI,"YES")
        field(DTYP,"Soft Channel")
        field(INP, "0")
        field(ZNAM,"Manual Control")
        field(ONAM,"Auto-Start")
}
record(bi,"$(user):trajSeqOnC") {
        field(DESC, "Trajectory Sequence running")
        field(DTYP,"Soft Channel")
        field(INP, "0")
        field(ZNAM,"Not Running")
        field(ONAM,"Running")
}
record(bo,"$(user):gunOnC") {
        field(DESC,"E-Gun Enable")
        field(ASG,"$(user)")
        field(DTYP,"Soft Channel")
        field(ZNAM,"Beam Off")
        field(ONAM,"Beam On")
}
record(bo,"$(user):gunBakeoutC") {
        field(DESC,"Bakeout Mode")
        field(DTYP,"Soft Channel")
        field(ZNAM,"Normal")
        field(ONAM,"Bakeout")
}
record(calc,"$(user):flameM") {
        field(CALC,"A<32?A+1:0")
        field(SCAN,".1 second")
        field(INPA,"$(user):flameM.VAL NPP NMS")
}
record(ao,"$(user):cathodeCurrentC") {
        field(DESC,"Cathode Current Control")
        field(ASG,"$(user)")
        field(DTYP,"Raw Soft Channel")
        field(SCAN,".1 second")
        field(OROC,".05")
        field(PREC,"2")
        field(EGU,"Amps")
        field(DRVH,"20")
        field(DRVL,"0")
        field(HOPR,"20")
        field(LOPR,"0")
}
record(calc,"$(user):rampM") {
        field(CALC,"A>6.27?0:A+.1")
        field(SCAN,"1 second")
        field(INPA,"$(user):rampM.VAL NPP NMS")
}
record(calc,"$(user):cathodeTempM") {
        field(DESC,"Cathode Measured Temp")
        field(SCAN,"1 second")
        field(CALC,"C+(A*7)+(SIN(B)*3.5)")
        field(INPA,"$(user):cathodeCurrentC.OVAL NPP NMS")
        field(INPB,"$(user):rampM.VAL NPP NMS")
        field(INPC,"70")
        field(EGU,"degC")
        field(PREC,"1")
        field(HOPR,"200")
        field(LOPR,"")
        field(HIHI,"180")
        field(LOLO,"130")
        field(HIGH,"160")
        field(LOW,"140")
        field(HHSV,"MAJOR")
        field(HSV,"MINOR")
        field(LLSV,"MAJOR")
        field(LSV,"MINOR")
}
record(calc,"$(user):CM1:intensityM") {
        field(DESC,"CM1 Intensity")
        field(SCAN,"1 second")
        field(CALC,"((!B)||(A>185)||(A<120))?0:A/10")
        field(INPA,"$(user):cathodeTempM.VAL NPP NMS")
        field(INPB,"$(user):gunOnC.VAL NPP NMS")
        field(EGU,"mA")
        field(PREC,"2")
        field(HOPR,"20")
        field(LOPR,"0")
        field(HIHI,"36")
        field(HIGH,"33")
        field(HHSV,"MAJOR")
        field(HSV,"MINOR")
}
record(ao,"$(user):H1:setCurrentC") {
        field(DESC,"H1 current setpoint")
        field(ASG,"$(user)")
        field(PREC,"2")
        field(EGU,"Amps")
        field(DOL,"$(user)A:H1:setCurrentC.RVAL NMS")
        field(OMSL,"supervisory")
        field(DRVH,"5")
        field(DRVL,"-5")
        field(HOPR,"5")
        field(LOPR,"-5")
}
record(ao,"$(user):V1:setCurrentC") {
        field(DESC,"V1 current setpoint")
        field(ASG,"$(user)")
        field(PREC,"2")
        field(EGU,"Amps")
        field(DOL,"$(user)A:V1:setCurrentC.RVAL CP NMS")
        field(OMSL,"supervisory")
        field(DRVH,"5")
        field(DRVL,"-5")
        field(HOPR,"5")
        field(LOPR,"-5")
}
record(ao,"$(user):H2:setCurrentC") {
        field(DESC,"H2 current setpoint")
        field(ASG,"$(user)")
        field(PREC,"2")
        field(EGU,"Amps")
        field(DOL,"$(user)A:H2:setCurrentC.RVAL CP NMS")
        field(OMSL,"supervisory")
        field(DRVH,"5")
        field(DRVL,"-5")
        field(HOPR,"5")
        field(LOPR,"-5")
}
record(ao,"$(user):V2:setCurrentC") {
        field(DESC,"V2 current setpoint")
        field(ASG,"$(user)")
        field(PREC,"2")
        field(EGU,"Amps")
        field(DOL,"$(user)A:V2:setCurrentC.RVAL CP NMS")
        field(OMSL,"supervisory")
        field(DRVH,"5")
        field(DRVL,"-5")
        field(HOPR,"5")
        field(LOPR,"-5")
}
record(ao,"$(user):H3:setCurrentC") {
        field(DESC,"H3 current setpoint")
        field(ASG,"$(user)")
        field(PREC,"2")
        field(EGU,"Amps")
        field(DOL,"$(user)A:H3:setCurrentC.RVAL CP NMS")
        field(OMSL,"supervisory")
        field(DRVH,"5")
        field(DRVL,"-5")
        field(HOPR,"5")
        field(LOPR,"-5")
}
record(ao,"$(user):V3:setCurrentC") {
        field(DESC,"V3 current setpoint")
        field(ASG,"$(user)")
        field(PREC,"2")
        field(EGU,"Amps")
        field(DOL,"$(user)A:V3:setCurrentC.RVAL CP NMS")
        field(OMSL,"supervisory")
        field(DRVH,"5")
        field(DRVL,"-5")
        field(HOPR,"5")
        field(LOPR,"-5")
}
record(ao,"$(user):H4:setCurrentC") {
        field(DESC,"H4 current setpoint")
        field(ASG,"$(user)")
        field(PREC,"2")
        field(EGU,"Amps")
        field(DOL,"$(user)A:H4:setCurrentC.RVAL CP NMS")
        field(OMSL,"supervisory")
        field(DRVH,"5")
        field(DRVL,"-5")
        field(HOPR,"5")
        field(LOPR,"-5")
}
record(ao,"$(user):V4:setCurrentC") {
        field(DESC,"V4 current setpoint")
        field(ASG,"$(user)")
        field(PREC,"2")
        field(EGU,"Amps")
        field(DOL,"$(user)A:V4:setCurrentC.RVAL CP NMS")
        field(OMSL,"supervisory")
        field(DRVH,"5")
        field(DRVL,"-5")
        field(HOPR,"5")
        field(LOPR,"-5")
}
record(ao,"$(user):H5:setCurrentC") {
        field(DESC,"H5 current setpoint")
        field(ASG,"$(user)")
        field(PREC,"2")
        field(EGU,"Amps")
        field(DOL,"$(user)A:H5:setCurrentC.RVAL CP NMS")
        field(OMSL,"supervisory")
        field(DRVH,"5")
        field(DRVL,"-5")
        field(HOPR,"5")
        field(LOPR,"-5")
}
record(ao,"$(user):V5:setCurrentC") {
        field(DESC,"V5 current setpoint")
        field(ASG,"$(user)")
        field(PREC,"2")
        field(EGU,"Amps")
        field(DOL,"$(user)A:V5:setCurrentC.RVAL CP NMS")
        field(OMSL,"supervisory")
        field(DRVH,"5")
        field(DRVL,"-5")
        field(HOPR,"5")
        field(LOPR,"-5")
}
record(ao,"$(user):BM1:setCurrentC") {
        field(DESC,"BM1 current setpoint")
        field(ASG,"$(user)")
        field(PREC,"1")
        field(EGU,"Amps")
        field(DRVH,"250")
        field(DRVL,"0")
        field(HOPR,"250")
        field(LOPR,"0")
}
# These PVs drive the sliders (AO's) during the Computer-Auto sequence
# by setting psNormalModeC to "0"
record(bo,"$(user):psNormalModeC") {
        field(DESC,"Disables ramps to PS AO's")
        field(PINI,"YES")
        field(DOL,"1")
        field(DTYP,"Soft Channel")
        field(ZNAM,"Ramp")
        field(ONAM,"Normal")
}
record(ao,"$(user)A:cathodeCurrentC") {
        field(DESC,"set output current")
        field(SIML,"$(user):psNormalModeC NPP NMS")
        field(SCAN,".1 second")
        field(DRVH,"20")
        field(DRVL,"0")
        field(OUT,"$(user):cathodeCurrentC PP NMS")
}
record(ao,"$(user)A:H1:setCurrentC") {
        field(DESC,"set output current")
        field(SIML,"$(user):psNormalModeC NPP NMS")
        field(SCAN,".1 second")
        field(PREC,"2")
        field(EGU,"Amps")
        field(DRVH,"5")
        field(DRVL,"-5")
        field(HOPR,"5")
        field(LOPR,"-5")
        field(OROC,".1")
        field(OUT,"$(user):H1:setCurrentC PP NMS")
}
record(ao,"$(user)A:V1:setCurrentC") {
        field(DESC,"set output current")
        field(SIML,"$(user):psNormalModeC NPP NMS")
        field(SCAN,".1 second")
        field(PREC,"2")
        field(EGU,"Amps")
        field(DRVH,"5")
        field(DRVL,"-5")
        field(HOPR,"5")
        field(LOPR,"-5")
        field(OROC,".1")
        field(OUT,"$(user):V1:setCurrentC PP NMS")
}
record(ao,"$(user)A:H2:setCurrentC") {
        field(DESC,"set output current")
        field(SIML,"$(user):psNormalModeC NPP NMS")
        field(SCAN,".1 second")
        field(PREC,"2")
        field(EGU,"Amps")
        field(DRVH,"5")
        field(DRVL,"-5")
        field(HOPR,"5")
        field(LOPR,"-5")
        field(OROC,".1")
        field(OUT,"$(user):H2:setCurrentC PP NMS")
}
record(ao,"$(user)A:V2:setCurrentC") {
        field(DESC,"set output current")
        field(SIML,"$(user):psNormalModeC NPP NMS")
        field(SCAN,".1 second")
        field(PREC,"2")
        field(EGU,"Amps")
        field(DRVH,"5")
        field(DRVL,"-5")
        field(HOPR,"5")
        field(LOPR,"-5")
        field(OROC,".1")
        field(OUT,"$(user):V2:setCurrentC PP NMS")
}
record(ao,"$(user)A:H3:setCurrentC") {
        field(DESC,"set output current")
        field(SIML,"$(user):psNormalModeC NPP NMS")
        field(SCAN,".1 second")
        field(PREC,"2")
        field(EGU,"Amps")
        field(DRVH,"5")
        field(DRVL,"-5")
        field(HOPR,"5")
        field(LOPR,"-5")
        field(OROC,".1")
        field(OUT,"$(user):H3:setCurrentC PP NMS")
}
record(ao,"$(user)A:V3:setCurrentC") {
        field(DESC,"set output current")
        field(SIML,"$(user):psNormalModeC NPP NMS")
        field(SCAN,".1 second")
        field(PREC,"2")
        field(EGU,"Amps")
        field(DRVH,"5")
        field(DRVL,"-5")
        field(HOPR,"5")
        field(LOPR,"-5")
        field(OROC,".1")
        field(OUT,"$(user):V3:setCurrentC PP NMS")
}
record(ao,"$(user)A:H4:setCurrentC") {
        field(DESC,"set output current")
        field(SIML,"$(user):psNormalModeC NPP NMS")
        field(SCAN,".1 second")
        field(PREC,"2")
        field(EGU,"Amps")
        field(DRVH,"5")
        field(DRVL,"-5")
        field(HOPR,"5")
        field(LOPR,"-5")
        field(OROC,".1")
        field(OUT,"$(user):H4:setCurrentC PP NMS")
}
record(ao,"$(user)A:V4:setCurrentC") {
        field(DESC,"set output current")
        field(SIML,"$(user):psNormalModeC NPP NMS")
        field(SCAN,".1 second")
        field(PREC,"2")
        field(EGU,"Amps")
        field(DRVH,"5")
        field(DRVL,"-5")
        field(HOPR,"5")
        field(LOPR,"-5")
        field(OROC,".1")
        field(OUT,"$(user):V4:setCurrentC PP NMS")
}
record(ao,"$(user)A:H5:setCurrentC") {
        field(DESC,"set output current")
        field(SIML,"$(user):psNormalModeC NPP NMS")
        field(SCAN,".1 second")
        field(PREC,"2")
        field(EGU,"Amps")
        field(DRVH,"5")
        field(DRVL,"-5")
        field(HOPR,"5")
        field(LOPR,"-5")
        field(OROC,".1")
        field(OUT,"$(user):H5:setCurrentC PP NMS")
}
record(ao,"$(user)A:V5:setCurrentC") {
        field(DESC,"set output current")
        field(SIML,"$(user):psNormalModeC NPP NMS")
        field(SCAN,".1 second")
        field(PREC,"2")
        field(EGU,"Amps")
        field(DRVH,"5")
        field(DRVL,"-5")
        field(HOPR,"5")
        field(LOPR,"-5")
        field(OROC,".1")
        field(OUT,"$(user):V5:setCurrentC PP NMS")
}
record(calc,"$(user):randomM") {
        field(CALC,"(RNDM*.1)-.05")
}
record(calc,"$(user):PM1:X:positionM") {
        field(DESC,"PM1:X")
        field(SCAN,".2 second")
        field(CALC,"C<.5?0:ABS(A-E)>1?(A-E)^3+D:(A-E)*2+D")
        field(INPA,"$(user):H1:setCurrentC.VAL NPP NMS")
        field(INPB,"$(user):H1:setCurrentC.VAL NPP NMS")
        field(INPC,"$(user):CM1:intensityM.VAL NPP NMS")
        field(INPD,"$(user):randomM.VAL PP NMS")
        field(INPE,"-1.3")
        field(EGU,"mm")
        field(PREC,"2")
        field(HOPR,"5")
        field(LOPR,"-5")
        field(HIHI,"4")
        field(LOLO,"-4")
        field(HIGH,"1")
        field(LOW,"-1")
        field(HHSV,"MAJOR")
        field(LLSV,"MAJOR")
        field(HSV,"MINOR")
        field(LSV,"MINOR")
}
record(calc,"$(user):PM1:Y:positionM") {
        field(DESC,"PM1:Y")
        field(SCAN,".2 second")
        field(CALC,"C<.5?0:ABS(A-E)>1?(A-E)^3+D:(A-E)*2+D")
        field(INPA,"$(user):V1:setCurrentC.VAL NPP NMS")
        field(INPB,"$(user):V1:setCurrentC.VAL NPP NMS")
        field(INPC,"$(user):CM1:intensityM.VAL NPP NMS")
        field(INPD,"$(user):randomM.VAL PP NMS")
        field(INPE,"1.8")
        field(EGU,"mm")
        field(PREC,"2")
        field(HOPR,"5")
        field(LOPR,"-5")
        field(HIHI,"4")
        field(LOLO,"-4")
        field(HIGH,"1")
        field(LOW,"-1")
        field(HHSV,"MAJOR")
        field(LLSV,"MAJOR")
        field(HSV,"MINOR")
        field(LSV,"MINOR")
}
record(calc,"$(user):PM1:beamPresentM") {
        field(DESC,"PM1 beam present")
        field(CALC,"(A>.5)&&(B<2)&&(C<2)")
        field(INPA,"$(user):CM1:intensityM.VAL NPP NMS")
        field(INPB,"$(user):PM1:X:positionM.SEVR NPP NMS")
        field(INPC,"$(user):PM1:Y:positionM.SEVR NPP NMS")
}
record(calc,"$(user):PM1:intensityM") {
        field(DESC,"PM1 Intensity")
        field(SCAN,".5 second")
        field(CALC,"!A?0:B*(E-MIN(ABS(C)+ABS(D),E))/F")
        field(INPA,"$(user):PM1:beamPresentM.VAL PP NMS")
        field(INPB,"$(user):CM1:intensityM.VAL NPP NMS")
        field(INPC,"$(user):PM1:X:positionM.VAL NPP NMS")
        field(INPD,"$(user):PM1:Y:positionM.VAL NPP NMS")
        field(INPE,"10")
        field(INPF,"11")
        field(HOPR,"20")
        field(LOPR,"0")
        field(EGU,"mA")
        field(PREC,"2")
}
record(calc,"$(user):PM2:X:positionM") {
        field(DESC,"PM2:X")
        field(SCAN,".2 second")
        field(CALC,"C<.5?0:ABS(A-E)>1?(A-E)^3+B:(A-E)*2+B+D")
        field(INPA,"$(user):H2:setCurrentC.VAL NPP NMS")
        field(INPB,"$(user):H1:setCurrentC.VAL NPP NMS")
        field(INPC,"$(user):PM1:intensityM.VAL NPP NMS")
        field(INPD,"$(user):randomM.VAL PP NMS")
        field(INPE,"2.0")
        field(EGU,"mm")
        field(PREC,"2")
        field(HOPR,"5")
        field(LOPR,"-5")
        field(HIHI,"4")
        field(LOLO,"-4")
        field(HIGH,"1")
        field(LOW,"-1")
        field(HHSV,"MAJOR")
        field(LLSV,"MAJOR")
        field(HSV,"MINOR")
        field(LSV,"MINOR")
}
record(calc,"$(user):PM2:Y:positionM") {
        field(DESC,"PM2:Y")
        field(SCAN,".2 second")
        field(CALC,"C<.5?0:ABS(A-E)>1?(A-E)^3+B:(A-E)*2+B+D")
        field(INPA,"$(user):V2:setCurrentC.VAL NPP NMS")
        field(INPB,"$(user):V1:setCurrentC.VAL NPP NMS")
        field(INPC,"$(user):PM1:intensityM.VAL NPP NMS")
        field(INPD,"$(user):randomM.VAL PP NMS")
        field(INPE,"-.5")
        field(EGU,"mm")
        field(PREC,"2")
        field(HOPR,"5")
        field(LOPR,"-5")
        field(HIHI,"4")
        field(LOLO,"-4")
        field(HIGH,"1")
        field(LOW,"-1")
        field(HHSV,"MAJOR")
        field(LLSV,"MAJOR")
        field(HSV,"MINOR")
        field(LSV,"MINOR")
}
record(calc,"$(user):PM2:beamPresentM") {
        field(DESC,"PM2 beam present")
        field(CALC,"(A>.5)&&(B<2)&&(C<2)")
        field(INPA,"$(user):PM1:intensityM.VAL NPP NMS")
        field(INPB,"$(user):PM2:X:positionM.SEVR NPP NMS")
        field(INPC,"$(user):PM2:Y:positionM.SEVR NPP NMS")
}
record(calc,"$(user):PM2:intensityM") {
        field(DESC,"PM2 Intensity")
        field(SCAN,".5 second")
        field(CALC,"!A?0:B*(E-MIN(ABS(C)+ABS(D),E))/F")
        field(INPA,"$(user):PM2:beamPresentM.VAL PP NMS")
        field(INPB,"$(user):PM1:intensityM.VAL NPP NMS")
        field(INPC,"$(user):PM2:X:positionM.VAL NPP NMS")
        field(INPD,"$(user):PM2:Y:positionM.VAL NPP NMS")
        field(INPE,"10")
        field(INPF,"11")
        field(HOPR,"20")
        field(LOPR,"0")
        field(EGU,"mA")
        field(PREC,"2")
}
record(calc,"$(user):PM3:X:positionM") {
        field(DESC,"PM3:X")
        field(SCAN,".2 second")
        field(CALC,"F#1||!C?0:ABS(A-E)>1?(A-E)^3:(A-E)*2+B")
        field(INPA,"$(user):H3:setCurrentC.VAL NPP NMS")
        field(INPB,"$(user):H2:setCurrentC.VAL NPP NMS")
        field(INPC,"$(user):PM2:intensityM.VAL NPP NMS")
        field(INPD,"$(user):randomM.VAL PP NMS")
        field(INPE,"-0.7")
        field(INPF,"$(user):GV1:positionM.VAL NPP NMS")
        field(EGU,"mm")
        field(PREC,"2")
        field(HOPR,"5")
        field(LOPR,"-5")
        field(HIHI,"4")
        field(LOLO,"-4")
        field(HIGH,"1")
        field(LOW,"-1")
        field(HHSV,"MAJOR")
        field(LLSV,"MAJOR")
        field(HSV,"MINOR")
        field(LSV,"MINOR")
}
record(calc,"$(user):PM3:Y:positionM") {
        field(DESC,"PM3:Y")
        field(SCAN,".2 second")
        field(CALC,"F#1||!C?0:ABS(A-E)>1?(A-E)^3:(A-E)*2+B")
        field(INPA,"$(user):V3:setCurrentC.VAL NPP NMS")
        field(INPB,"$(user):V2:setCurrentC.VAL NPP NMS")
        field(INPC,"$(user):PM2:intensityM.VAL NPP NMS")
        field(INPD,"$(user):randomM.VAL PP NMS")
        field(INPE,"-1.5")
        field(INPF,"$(user):GV1:positionM.VAL NPP NMS")
        field(EGU,"mm")
        field(PREC,"2")
        field(HOPR,"5")
        field(LOPR,"-5")
        field(HIHI,"4")
        field(LOLO,"-4")
        field(HIGH,"1")
        field(LOW,"-1")
        field(HHSV,"MAJOR")
        field(LLSV,"MAJOR")
        field(HSV,"MINOR")
        field(LSV,"MINOR")
}
record(calc,"$(user):PM3:beamPresentM") {
        field(DESC,"PM3 beam present")
        field(CALC,"(A>.5)&&(B<2)&&(C<2)&&(D=1)")
        field(INPA,"$(user):PM2:intensityM.VAL NPP NMS")
        field(INPB,"$(user):PM3:X:positionM.SEVR NPP NMS")
        field(INPC,"$(user):PM3:Y:positionM.SEVR NPP NMS")
        field(INPD,"$(user):GV1:positionM.VAL NPP NMS")
}
record(calc,"$(user):PM3:intensityM") {
        field(DESC,"PM3 Intensity")
        field(SCAN,".5 second")
        field(CALC,"!A?0:B*(E-MIN(ABS(C)+ABS(D),E))/F")
        field(INPA,"$(user):PM3:beamPresentM.VAL PP NMS")
        field(INPB,"$(user):PM2:intensityM.VAL NPP NMS")
        field(INPC,"$(user):PM3:X:positionM.VAL NPP NMS")
        field(INPD,"$(user):PM3:Y:positionM.VAL NPP NMS")
        field(INPE,"10")
        field(INPF,"11")
        field(HOPR,"20")
        field(LOPR,"0")
        field(EGU,"mA")
        field(PREC,"2")
}
record(calc,"$(user):PM4:X:positionM") {
        field(DESC,"PM4:X")
        field(SCAN,".2 second")
        field(CALC,"C<.5?0:ABS(A-E)>1?(A-E)^3+B:(A-E)*2+B+D")
        field(INPA,"$(user):H4:setCurrentC.VAL NPP NMS")
        field(INPB,"$(user):H3:setCurrentC.VAL NPP NMS")
        field(INPC,"$(user):PM3:intensityM.VAL NPP NMS")
        field(INPD,"$(user):randomM.VAL PP NMS")
        field(INPE,".8")
        field(EGU,"mm")
        field(PREC,"2")
        field(HOPR,"5")
        field(LOPR,"-5")
        field(HIHI,"4")
        field(LOLO,"-4")
        field(HIGH,"1")
        field(LOW,"-1")
        field(HHSV,"MAJOR")
        field(LLSV,"MAJOR")
        field(HSV,"MINOR")
        field(LSV,"MINOR")
}
record(calc,"$(user):PM4:Y:positionM") {
        field(DESC,"PM4:Y")
        field(SCAN,".2 second")
        field(CALC,"C<.5?0:ABS(A-E)>1?(A-E)^3+B:(A-E)*2+B+D")
        field(INPA,"$(user):V4:setCurrentC.VAL NPP NMS")
        field(INPB,"$(user):V3:setCurrentC.VAL NPP NMS")
        field(INPC,"$(user):PM3:intensityM.VAL NPP NMS")
        field(INPD,"$(user):randomM.VAL PP NMS")
        field(INPE,"-.3")
        field(EGU,"mm")
        field(PREC,"2")
        field(HOPR,"5")
        field(LOPR,"-5")
        field(HIHI,"4")
        field(LOLO,"-4")
        field(HIGH,"1")
        field(LOW,"-1")
        field(HHSV,"MAJOR")
        field(LLSV,"MAJOR")
        field(HSV,"MINOR")
        field(LSV,"MINOR")
}
record(calc,"$(user):PM4:beamPresentM") {
        field(DESC,"PM4 beam present")
        field(CALC,"(A>.5)&&(B<2)&&(C<2)")
        field(INPA,"$(user):PM3:intensityM.VAL NPP NMS")
        field(INPB,"$(user):PM4:X:positionM.SEVR NPP NMS")
        field(INPC,"$(user):PM4:Y:positionM.SEVR NPP NMS")
}
record(calc,"$(user):PM4:intensityM") {
        field(DESC,"PM4 Intensity")
        field(SCAN,".5 second")
        field(CALC,"!A?0:B*(E-MIN(ABS(C)+ABS(D),E))/F")
        field(INPA,"$(user):PM4:beamPresentM.VAL PP NMS")
        field(INPB,"$(user):PM3:intensityM.VAL NPP NMS")
        field(INPC,"$(user):PM4:X:positionM.VAL NPP NMS")
        field(INPD,"$(user):PM4:Y:positionM.VAL NPP NMS")
        field(INPE,"10")
        field(INPF,"11")
        field(HOPR,"20")
        field(LOPR,"0")
        field(EGU,"mA")
        field(PREC,"2")
}
record(calc,"$(user):PM5:X:positionM") {
        field(DESC,"PM5:X")
        field(SCAN,".2 second")
        field(CALC,"C<.5?0:ABS(A-E)>1?(A-E)^3+B:(A-E)*2+B+D")
        field(INPA,"$(user):H5:setCurrentC.VAL NPP NMS")
        field(INPB,"$(user):H4:setCurrentC.VAL NPP NMS")
        field(INPC,"$(user):PM4:intensityM.VAL NPP NMS")
        field(INPD,"$(user):randomM.VAL PP NMS")
        field(INPE,"-1.0")
        field(EGU,"mm")
        field(PREC,"2")
        field(HOPR,"5")
        field(LOPR,"-5")
        field(HIHI,"4")
        field(LOLO,"-4")
        field(HIGH,"1")
        field(LOW,"-1")
        field(HHSV,"MAJOR")
        field(LLSV,"MAJOR")
        field(HSV,"MINOR")
        field(LSV,"MINOR")
}
record(calc,"$(user):PM5:Y:positionM") {
        field(DESC,"PM5:Y")
        field(SCAN,".2 second")
        field(CALC,"C<.5?0:ABS(A-E)>1?(A-E)^3+B:(A-E)*2+B+D")
        field(INPA,"$(user):V5:setCurrentC.VAL NPP NMS")
        field(INPB,"$(user):V4:setCurrentC.VAL NPP NMS")
        field(INPC,"$(user):PM4:intensityM.VAL NPP NMS")
        field(INPD,"$(user):randomM.VAL PP NMS")
        field(INPE,"2.3")
        field(EGU,"mm")
        field(PREC,"2")
        field(HOPR,"5")
        field(LOPR,"-5")
        field(HIHI,"4")
        field(LOLO,"-4")
        field(HIGH,"1")
        field(LOW,"-1")
        field(HHSV,"MAJOR")
        field(LLSV,"MAJOR")
        field(HSV,"MINOR")
        field(LSV,"MINOR")
}
record(calc,"$(user):PM5:beamPresentM") {
        field(DESC,"PM5 beam present")
        field(CALC,"(A>.5)&&(B<2)&&(C<2)")
        field(INPA,"$(user):PM4:intensityM.VAL NPP NMS")
        field(INPB,"$(user):PM5:X:positionM.SEVR NPP NMS")
        field(INPC,"$(user):PM5:Y:positionM.SEVR NPP NMS")
}
record(calc,"$(user):PM5:intensityM") {
        field(DESC,"PM5 Intensity")
        field(SCAN,".5 second")
        field(CALC,"!A?0:B*(E-MIN(ABS(C)+ABS(D),E))/F")
        field(INPA,"$(user):PM5:beamPresentM.VAL PP NMS")
        field(INPB,"$(user):PM4:intensityM.VAL NPP NMS")
        field(INPC,"$(user):PM5:X:positionM.VAL NPP NMS")
        field(INPD,"$(user):PM5:Y:positionM.VAL NPP NMS")
        field(INPE,"10")
        field(INPF,"11")
        field(HOPR,"20")
        field(LOPR,"0")
        field(EGU,"mA")
        field(PREC,"2")
}
record(calc,"$(user):FC1:intensityM") {
        field(DESC,"FC1 Intensity")
        field(SCAN,".5 second")
        field(CALC,"A<.5?0:D>10?0:A*(11-D)/12")
        field(INPA,"$(user):PM5:intensityM.VAL NPP NMS")
        field(INPB,"$(user):PM5:X:positionM.VAL NPP NMS")
        field(INPC,"$(user):PM5:Y:positionM.VAL NPP NMS")
        field(INPD,"$(user):BM1:setCurrentC.VAL NPP NMS")
        field(HOPR,"20")
        field(LOPR,"0")
        field(EGU,"mA")
        field(PREC,"2")
}
record(calc,"$(user):FC2:intensityM") {
        field(DESC,"FC2 Intensity")
        field(SCAN,".5 second")
        field(CALC,"(D<213)||(D>216.12)?0:A*.9*SIN(D-E)")
        field(INPA,"$(user):PM5:intensityM.VAL NPP NMS")
        field(INPB,"$(user):PM5:X:positionM.VAL NPP NMS")
        field(INPC,"$(user):PM5:Y:positionM.VAL NPP NMS")
        field(INPD,"$(user):BM1:setCurrentC.VAL NPP NMS")
        field(INPE,"213")
        field(HOPR,"20")
        field(LOPR,"0")
        field(EGU,"mA")
        field(PREC,"2")
}
record(waveform,"$(user):PM:distancesWF") {
        field(DESC,"bpm distances from gun")
        field(DTYP,"Soft Channel")
        field(INP,"[9.0,20.0,33.0,44.0,54.5,58.0]")
        field(PINI,"YES")
        field(EGU,"meters")
        field(HOPR,"60")
        field(LOPR,"0")
        field(NELM,"6")
        field(FTVL,"FLOAT")
        }
record(waveform,"$(user):PM:refLocationsWF") {
        field(DTYP,"Soft Channel")
        field(EGU,"meters")
        field(HOPR,"60")
        field(LOPR,"0")
        field(NELM,"2")
        field(FTVL,"FLOAT")
        }
record(waveform,"$(user):PM:referenceLoWF") {
        field(DTYP,"Soft Channel")
        field(EGU,"meters")
        field(HOPR,"20")
        field(LOPR,"-5")
        field(NELM,"2")
        field(FTVL,"FLOAT")
        }
record(waveform,"$(user):PM:referenceHiWF") {
        field(DTYP,"Soft Channel")
        field(EGU,"meters")
        field(HOPR,"20")
        field(LOPR,"-5")
        field(NELM,"2")
        field(FTVL,"FLOAT")
        }
record(waveform,"$(user):PM:xTrajectoryWF") {
        field(DESC,"x values")
        field(DTYP,"Soft Channel")
        field(EGU,"mm")
        field(INP,"[0.0,0.0,0.0,0.0,0.0]")
        field(HOPR,"20")
        field(LOPR,"-5")
        field(NELM,"6")
        field(FTVL,"FLOAT")
        field(PINI,"YES")
}
record(waveform,"$(user):PM:yTrajectoryWF") {
        field(DESC,"y values")
        field(DTYP,"Soft Channel")
        field(EGU,"mm")
        field(INP,"[0.0,0.0,0.0,0.0,0.0]")
        field(HOPR,"20")
        field(LOPR,"-5")
        field(NELM,"6")
        field(FTVL,"FLOAT")
        field(PINI,"YES")
}
record(waveform,"$(user):PM:iTrajectoryWF") {
        field(DESC,"i values")
        field(DTYP,"Soft Channel")
        field(EGU,"mm")
        field(INP,"[0.0,0.0,0.0,0.0,0.0]")
        field(HOPR,"20")
        field(LOPR,"-5")
        field(NELM,"8")
        field(FTVL,"FLOAT")
}
record(mbbo,"$(user):GV1:positionC") {
        field(DESC,"valve position")
        field(ASG,"$(user)")
        field(DTYP,"Raw Soft Channel")
        field(ZRVL,"0x3")
        field(ONVL,"0xc")
        field(ZRST,"Close")
        field(ONST,"Open")
        field(FLNK,"$(user):GV1:positionSQ.VAL")
}
record(seq,"$(user):GV1:positionSQ") {
        field(DESC,"simulate open/close")
        field(SELM,"Mask")
        field(SELL,"$(user):GV1:positionC.RVAL NPP NMS") 
        field(DOL1,"0")
        field(LNK1,"$(user):GV1:positionM.VAL PP NMS")
        field(DLY2,"1")
        field(DOL2,"2")
        field(LNK2,"$(user):GV1:positionM.VAL PP NMS")
        field(DOL3,"0")
        field(LNK3,"$(user):GV1:positionM.VAL PP NMS")
        field(DLY4,"1")
        field(DOL4,"1")
        field(LNK4,"$(user):GV1:positionM.VAL PP NMS")
}
record(mbbi,"$(user):GV1:positionM") {
        field(DESC,"GV1 valve position")
        field(PINI,"YES")
        field(INP,"2")
        field(ZRST,"Travel")
        field(ONST,"Full Open")
        field(TWST,"Full Closed")
        field(THST,"Unknown")
        field(ZRSV,"MINOR")
        field(ONSV,"NO_ALARM")
        field(TWSV,"MAJOR")
        field(THSV,"INVALID")
}
record(ai,"$(user):opVariable1") {
        field(PREC, "4")
        field(EGU,"Ratio")
}
record(ai,"$(user):opVariable2") {
        field(PREC, "4")
        field(EGU,"void")
}
record(ai,"$(user):opVariable3") {
        field(PREC, "4")
        field(EGU,"void")
}
record(ai,"$(user):opVariable4") {
        field(PREC, "4")
        field(EGU,"void")
}
record(ai,"$(user):opVariable5") {
        field(PREC, "4")
        field(EGU,"void")
}
record(bo,"$(user):opButton1C") {
        field(DESC,"Misc. Button")
        field(DTYP,"Soft Channel")
        field(HIGH,"2")
        field(ZNAM,"Off")
        field(ONAM,"On")
}
record(bo,"$(user):opButton2C") {
        field(DESC,"Misc. Button")
        field(DTYP,"Soft Channel")
        field(HIGH,".5")
        field(ZNAM,"Off")
        field(ONAM,"On")
}
record(bo,"$(user):opButton3C") {
        field(DESC,"Misc. Button")
        field(DTYP,"Soft Channel")
        field(HIGH,".5")
        field(ZNAM,"Off")
        field(ONAM,"On")
}
#record(scan,"$(user):scan1SC") {
#        field(MPTS,"512")
#}
#record(scan,"$(user):scan2SC") {
#        field(MPTS,"512")
#}
#record(scan,"$(user):scan3SC") {
#        field(MPTS,"512")
#}
#record(scan,"$(user):scan4SC") {
#        field(MPTS,"512")
#}
record(calcout,"$(user):scanCtl1CO") { field(OCAL,"0") field(CALC,"0") }
record(calcout,"$(user):scanCtl2CO") { field(OCAL,"0") field(CALC,"0") }
record(calcout,"$(user):scanCtl3CO") { field(OCAL,"0") field(CALC,"0") }
record(calcout,"$(user):scanCtl4CO") { field(OCAL,"0") field(CALC,"0") }
record(calcout,"$(user):scanCtl5CO") { field(OCAL,"0") field(CALC,"0") }

record(bo,"$(user):OP:stabilizerC") {
        field(ZNAM,"Off")
        field(ONAM,"Stabilize")
}
record(stringin,"$(user):OP:stabilizerMsg") {
        field(VAL,"Sequence Off")
}
record(stringin,"$(user):OP:autoMsg") {
        field(VAL,"Sequencer program not running")
}
record(stringin,"$(user):operatorM") {
        field(VAL,"")
}
record(seq,"$(user):initAllSQ") {
        field(DOL1,"0")
        field(LNK1,"$(user):autoC.VAL PP NMS")
        field(DOL2,"1")
        field(LNK2,"$(user):psNormalModeC.VAL PP NMS")
        field(DLY3,".1")
        field(DOL3,"0")
        field(LNK3,"$(user):cathodeCurrentC.VAL PP NMS")
        field(DOL4,"0")
        field(LNK4,"$(user):cathodeCurrentC.OVAL PP NMS")
        field(DOL5,"0")
        field(LNK5,"$(user):gunOnC.VAL PP NMS")
        field(DOL6,"0")
        field(LNK6,"$(user):GV1:positionC.VAL PP NMS")
        field(FLNK,"$(user):initSteeringSQ.VAL PP NMS")
}
record(seq,"$(user):initSteeringSQ") {
        field(DOL1,"0")
        field(LNK1,"$(user):H1:setCurrentC.VAL PP NMS")
        field(DOL2,"0")
        field(LNK2,"$(user):V1:setCurrentC.VAL PP NMS")
        field(DOL3,"0")
        field(LNK3,"$(user):H2:setCurrentC.VAL PP NMS")
        field(DOL4,"0")
        field(LNK4,"$(user):V2:setCurrentC.VAL PP NMS")
        field(DOL5,"0")
        field(LNK5,"$(user):H3:setCurrentC.VAL PP NMS")
        field(DOL6,"0")
        field(LNK6,"$(user):V3:setCurrentC.VAL PP NMS")
        field(DOL7,"0")
        field(LNK7,"$(user):H4:setCurrentC.VAL PP NMS")
        field(DOL8,"0")
        field(LNK8,"$(user):V4:setCurrentC.VAL PP NMS")
        field(DOL9,"0")
        field(LNK9,"$(user):H5:setCurrentC.VAL PP NMS")
        field(DOLA,"0")
        field(LNKA,"$(user):V5:setCurrentC.VAL PP NMS")
}

